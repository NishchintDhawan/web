#
#  This makefile was generated by mm.
#

#/*+
#************************************************************************
#****  C A N A D I A N   A S T R O N O M Y   D A T A   C E N T R E  *****
#*
#*   File Name:	makestart
#*
#*   Purpose:
#*	This is used by makemake to automatically create a makefile.
#*
#*   Date		: Aug 2, 2013
#*
#*   Subversion data:
#*	$URL$
#*	$Revision$
#*
#*   Programmer		: Norm Hill
#*
#****  C A N A D I A N   A S T R O N O M Y   D A T A   C E N T R E  *****
#************************************************************************
#-*/

OS_FAMILY = $(shell uname)

ifeq ($(OS_FAMILY),Darwin)
  PHANTOMJS_DIR = Mac\ OS\ X
else
  PHANTOMJS_DIR = ${OS_FAMILY}
endif

TEST_CMD = test/phantomjs/${PHANTOMJS_DIR}/phantomjs
TEST_ARGS = test/qunit-runner.js --qunit test/qunit-1.10.0.js
TEST_URI_PKG_ARGS = $(TEST_ARGS) --package test/src/www/javascript/uri/package.json --tests test/src/www/javascript/uri/test.uri.js --junit test/src/www/javascript/uri/qunit-results.xml test/src/www/javascript/uri/test.uri.js
TEST_URI_CMD = $(TEST_CMD) $(TEST_URI_PKG_ARGS)
TEST_UTIL_PKG_ARGS = $(TEST_ARGS) --package test/src/www/javascript/util/package.json --tests test/src/www/javascript/util/test.util.js --junit test/src/www/javascript/util/qunit-results.xml test/src/www/javascript/util/test.util.js
TEST_UTIL_CMD = $(TEST_CMD) $(TEST_UTIL_PKG_ARGS)

.PHONY: test

all: rsync makelinks changegr

changegr:
	@echo Not changing groups

install:
	${RSYNC} $(RSYNC_FLAGS) $(DEST)/www $(RPS)

test:
	$(TEST_URI_CMD) && $(TEST_UTIL_CMD)

makelinks:  test

#
#  makestart end
#

RSYNC = rsync
RSYNC_FLAGS = -vruptog --exclude=RCS --exclude=*.swp --exclude=*~ --exclude=.svn*
SRC = src
DEST = build

release: all

all: rsync makelinks changegr


rsync: $(SRC)/cgi $(SRC)/www
	${RSYNC} $(RSYNC_FLAGS) $(SRC)/cgi $(DEST);
	setModificationDate.sh $(DEST)/cgi;
	${RSYNC} $(RSYNC_FLAGS) $(SRC)/www $(DEST);
	setModificationDate.sh $(DEST)/www;

$(SRC)/cgi:
	mkdir -p $(SRC)/cgi

$(SRC)/www:
	mkdir -p $(SRC)/www

makelinks: rsync

changegr: 
	chgrp cadcdev build

clean:
	rm -rf build/cgi;
	rm -rf build/www
